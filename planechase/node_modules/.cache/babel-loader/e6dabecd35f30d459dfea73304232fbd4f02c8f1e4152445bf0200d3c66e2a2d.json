{"ast":null,"code":"import React, { useState, useEffect } from 'react';\nconst dataSource = 'dhuber-cluster-0';\nconst database = 'planechase';\nconst sessionCollection = 'sessions';\nfunction getHeaders() {\n  const headers = new Headers();\n  headers.append('Content-Type', 'application/json');\n  headers.append('Accept', 'application/json');\n  headers.append('Access-Control-Request-Headers', '*');\n  headers.append('Access-Control-Allow-Origin', '*');\n  headers.append('api-key', 'kqhoHk09XphZcWMeBlGUOgDSXwvQDDkkn5mRXreTwyV6afivwZYiTnit6JSt7JyO');\n}\nexport async function getSession(sessionCode, activePlane) {\n  //   curl --location 'https://us-east-1.aws.data.mongodb-api.com/app/data-napyt/endpoint/data/v1/action/findOne' \\\n  // --header 'Content-Type: application/json' \\\n  // --header 'Access-Control-Request-Headers: *' \\\n  // --header 'api-key: kqhoHk09XphZcWMeBlGUOgDSXwvQDDkkn5mRXreTwyV6afivwZYiTnit6JSt7JyO' \\\n  // --header 'Accept: application/json' \\\n  // --data '{\n  //       \"dataSource\": \"dhuber-cluster-0\",\n  //       \"database\": \"planechase\",\n  //       \"collection\": \"sessions\",\n  //       \"filter\": { \"_id\": \"ABCD\"  }\n  //   }'\n\n  console.log('setting up mongoDb');\n  if (sessionCode) {\n    console.log('getting session ' + sessionCode);\n    return await getExistingSession(sessionCode);\n  }\n  console.log('making new session');\n  return await getNewSession(activePlane);\n}\nasync function getNewSession(activePlane) {\n  const body = JSON.stringify({\n    'dataSource': dataSource,\n    'database': database,\n    'collection': sessionCollection\n  });\n  return await fetch(`/planechaseSessions/makeSession/${activePlane.id}`).then(response => response.json()).then(data => {\n    console.log(data[0]);\n    return {\n      session: data[0].pk,\n      plane: data[0].fields.plane,\n      rollCost: data[0].fields.rollCost\n    };\n  }).catch(error => console.log('error'));\n}\nasync function getExistingSession(sessionCode) {\n  const body = JSON.stringify({\n    'dataSource': dataSource,\n    'database': database,\n    'collection': sessionCollection,\n    'filter': {\n      '_id': 1\n    }\n  });\n  const requestOptions = {\n    method: 'POST',\n    headers: getHeaders(),\n    body: body,\n    mode: 'no-cors'\n  };\n\n  // fetch('https://us-east-1.aws.data.mongodb-api.com/app/data-napyt/endpoint/data/v1/action/findOne', requestOptions)\n  //   .then(response => response.json())\n  //   .then(data => sessionData = data)\n  //   .catch(error => console.error(error));\n  // console.log('session: ' + sessionData);\n\n  return await fetch(`/planechaseSessions/getSession/${sessionCode}`).then(response => response.json()).then(data => {\n    console.log(data[0]);\n    return {\n      session: data[0].pk,\n      plane: data[0].fields.plane,\n      rollCost: data[0].fields.rollCost\n    };\n  }).catch(error => console.log('error'));\n}\nexport async function getAllPlanes() {\n  console.log('getAllPlanes');\n  return await fetch(`/planechaseSessions/getAllPlanes`).then(response => response.json()).catch(error => console.log('error'));\n}\nexport async function setPlaneById(sessionCode, planeId) {\n  console.log('planeId: ' + planeId);\n  return await fetch(`/planechaseSessions/setPlane/${sessionCode}/${planeId}`).then(response => response.json()).catch(error => console.log('error'));\n}\nexport async function setPlaneByName(sessionCode, plane) {\n  const planeUrl = plane.split('/')[3].split('.')[0];\n  console.log('planeUrl: ' + planeUrl);\n  return await fetch(`/planechaseSessions/setPlane/${sessionCode}/${planeUrl}`).then(response => response.json()).catch(error => console.log('error'));\n}\nexport async function getAndSetNewPlane(sessionCode) {\n  return await fetch(`/planechaseSessions/getAndSetNewPlane/${sessionCode}`).then(response => response.json()).then(data => {\n    console.log(data[1]);\n    return data[1].fields;\n  }).catch(error => console.log('error'));\n}","map":{"version":3,"names":["React","useState","useEffect","dataSource","database","sessionCollection","getHeaders","headers","Headers","append","getSession","sessionCode","activePlane","console","log","getExistingSession","getNewSession","body","JSON","stringify","fetch","id","then","response","json","data","session","pk","plane","fields","rollCost","catch","error","requestOptions","method","mode","getAllPlanes","setPlaneById","planeId","setPlaneByName","planeUrl","split","getAndSetNewPlane"],"sources":["/Users/danhuber/Desktop/development/planechase-new/planechase/src/tools/mongoApi.js"],"sourcesContent":["import React, {useState, useEffect} from 'react';\n\nconst dataSource = 'dhuber-cluster-0';\nconst database = 'planechase';\nconst sessionCollection = 'sessions';\n\nfunction getHeaders() {\n  const headers = new Headers();\n  headers.append('Content-Type', 'application/json');\n  headers.append('Accept', 'application/json');\n  headers.append('Access-Control-Request-Headers', '*');\n  headers.append('Access-Control-Allow-Origin', '*');\n  headers.append('api-key', 'kqhoHk09XphZcWMeBlGUOgDSXwvQDDkkn5mRXreTwyV6afivwZYiTnit6JSt7JyO');\n}\n\nexport async function getSession(sessionCode, activePlane) {\n//   curl --location 'https://us-east-1.aws.data.mongodb-api.com/app/data-napyt/endpoint/data/v1/action/findOne' \\\n// --header 'Content-Type: application/json' \\\n// --header 'Access-Control-Request-Headers: *' \\\n// --header 'api-key: kqhoHk09XphZcWMeBlGUOgDSXwvQDDkkn5mRXreTwyV6afivwZYiTnit6JSt7JyO' \\\n// --header 'Accept: application/json' \\\n// --data '{\n//       \"dataSource\": \"dhuber-cluster-0\",\n//       \"database\": \"planechase\",\n//       \"collection\": \"sessions\",\n//       \"filter\": { \"_id\": \"ABCD\"  }\n//   }'\n\nconsole.log('setting up mongoDb');\n\nif (sessionCode) {\n  console.log('getting session ' + sessionCode);\n  return await getExistingSession(sessionCode);\n} \n  \nconsole.log('making new session');\nreturn await getNewSession(activePlane);\n}\n\nasync function getNewSession(activePlane) {\n  const body = JSON.stringify({\n    'dataSource': dataSource,\n    'database': database,\n    'collection': sessionCollection\n  });\n\n  return await fetch(`/planechaseSessions/makeSession/${activePlane.id}`)\n    .then(response => response.json())\n    .then(data => {\n      console.log(data[0]);\n      return {\n        session: data[0].pk,\n        plane: data[0].fields.plane,\n        rollCost: data[0].fields.rollCost\n      };\n    })\n    .catch(error => console.log('error'));\n}\n\nasync function getExistingSession(sessionCode) {\n  const body = JSON.stringify({\n    'dataSource': dataSource,\n    'database': database,\n    'collection': sessionCollection,\n    'filter': { '_id': 1 }\n  });\n\n  const requestOptions = {\n    method: 'POST',\n    headers: getHeaders(),\n    body: body,\n    mode: 'no-cors'\n  }\n\n  // fetch('https://us-east-1.aws.data.mongodb-api.com/app/data-napyt/endpoint/data/v1/action/findOne', requestOptions)\n  //   .then(response => response.json())\n  //   .then(data => sessionData = data)\n  //   .catch(error => console.error(error));\n  // console.log('session: ' + sessionData);\n\n  return await fetch(`/planechaseSessions/getSession/${sessionCode}`)\n    .then(response => response.json())\n    .then(data => {\n      console.log(data[0]);\n      return {\n        session: data[0].pk,\n        plane: data[0].fields.plane,\n        rollCost: data[0].fields.rollCost\n      };\n    })\n    .catch(error => console.log('error'));\n}\n\nexport async function getAllPlanes() {\n  console.log('getAllPlanes');\n  return await fetch(`/planechaseSessions/getAllPlanes`)\n    .then(response => response.json())\n    .catch(error => console.log('error'));\n}\n\nexport async function setPlaneById(sessionCode, planeId) {\n  console.log('planeId: ' + planeId);\n  return await fetch(`/planechaseSessions/setPlane/${sessionCode}/${planeId}`)\n    .then(response => response.json())\n    .catch(error => console.log('error'));\n}\n\nexport async function setPlaneByName(sessionCode, plane) {\n  const planeUrl = plane.split('/')[3].split('.')[0];\n  console.log('planeUrl: ' + planeUrl);\n  return await fetch(`/planechaseSessions/setPlane/${sessionCode}/${planeUrl}`)\n    .then(response => response.json())\n    .catch(error => console.log('error'));\n}\n\nexport async function getAndSetNewPlane(sessionCode) {\n  return await fetch(`/planechaseSessions/getAndSetNewPlane/${sessionCode}`)\n    .then(response => response.json())\n    .then(data => {\n      console.log(data[1]);\n      return data[1].fields;\n    })\n    .catch(error => console.log('error'));\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}